package ttjj.service;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import org.apache.commons.lang3.StringUtils;
import ttjj.dto.Kline;
import utils.DateUtil;
import utils.HttpUtil;

import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import static utils.ContExchange.*;
import static utils.DateUtil.YYYYMMDD;

/**
 * K线http查询(sohu)
 * 参考：
 * https://q.stock.sohu.com/hisHq?code=cn_159915&start=20240301&end=20250424&stat=1&order=D&period=w&callback=historySearchHandler&rt=jsonp
 * https://hq.stock.sohu.com/mkline/cn/050/cn_510050-11_2.html?_=1745468377604
 */
public class SohuService {

    public static void main(String[] args) {

        //查询K线-查询交易日列表，查询贵州茅台的日k线
        int count = -420;
        int limit = 60;
        String begDate = DateUtil.getCurDateStrAddDaysByFormat(YYYYMMDD, count);
        String endDate = DateUtil.getToday(YYYYMMDD);
//        String stCode = "517400";
        String zqdm = "159509";
//        String klineRs = SohuService.httpKlineRsStrHis(zqdm, KLINE_TYPE_WEEK, begDate, endDate);
//        System.out.println("k线：" + klineRs);
        List<Kline> klineList = findKline(zqdm, KLINE_TYPE_SOHU_MKLINE_MINITE_60, begDate, endDate, limit);
        int i = 1;
        for (Kline kline : klineList) {
            System.out.println((i++) + ":" + kline.getZqdm() + ":" + kline.getKtime() + ",收盘：" + kline.getCloseAmt() + ",涨幅：" + kline.getZhangDieFu());
        }
    }

    /**
     * 查询k线
     *
     * @param zqdm      证券代码
     * @param cycleType 周期
     * @param limit
     * @return k线列表
     */
    public static List<Kline> findKline(String zqdm, String cycleType, String startDay, String endDay, int limit) {
        boolean isShowLog = true;
        String methodName = "查询k线(sohu)：";
        String rs = SohuService.httpKlineRsStrMkline(zqdm, cycleType, startDay, endDay);//需要收集前一日的收盘价，所以+1，返回数据时需要去掉第一个数据
        if (rs == null) {
            System.out.println(methodName + "：返回null");
            return null;
        }
        JSONArray klines = null;
        //{"status":0,"dividend":[],"type":"quote_week","statusmsg":"ok","dataBasic":[["20250430","1.392","1.393","1.408","1.388","15118364.35","211440","0.00%","-0.001","-0.07%"],["20250425","1.320","1.394","1.400","1.307","30698407.00","416106","0.00%","0.068","5.13%"],["20250418","1.384","1.326","1.399","1.321","32071756.00","435055","0.00%","-0.034","-2.50%"],["20250411","1.230","1.360","1.375","1.201","44190042.87","573620","0.00%","-0.007","-0.51%"],["20250403","1.372","1.367","1.417","1.350","32476838.70","448263","0.00%","-0.048","-3.39%"],["20250328","1.448","1.415","1.496","1.411","35369529.09","514839","0.00%","-0.012","-0.84%"],["20250321","1.412","1.427","1.443","1.392","35472290.02","502952","0.00%","0.028","2.00%"],["20250314","1.443","1.399","1.454","1.343","62238473.04","860688","0.00%","-0.050","-3.45%"],["20250307","1.496","1.449","1.505","1.437","36383310.79","531935","0.00%","-0.027","-1.83%"],["20250228","1.560","1.476","1.569","1.465","30768458.07","469882","0.00%","-0.117","-7.34%"],["20250221","1.606","1.593","1.645","1.589","26901096.53","434833","0.00%","-0.012","-0.75%"],["20250214","1.583","1.605","1.610","1.575","14411170.90","229665","0.00%","0.009","0.56%"],["20250207","1.596","1.596","1.609","1.589","10549374.23","168609","0.00%","-0.009","-0.56%"],["20250127","1.610","1.605","1.617","1.600","4777138.40","76664","0.00%","-0.033","-2.01%"],["20250124","1.636","1.638","1.655","1.630","18003568.76","295529","0.00%","0.014","0.86%"],["20250117","1.603","1.624","1.639","1.580","23833387.65","383205","0.00%","-0.002","-0.12%"],["20250110","1.646","1.626","1.704","1.624","33220027.47","549819","0.00%","0.005","0.31%"],["20250103","1.615","1.621","1.632","1.600","21512490.20","348139","0.00%","-0.017","-1.04%"],["20241227","1.605","1.638","1.666","1.604","36222906.62","594466","0.00%","0.061","3.87%"],["20241220","1.581","1.577","1.663","1.572","48931264.66","793679","0.00%","-0.001","-0.06%"],["20241213","1.547","1.578","1.582","1.518","24754360.17","384943","0.00%","0.039","2.53%"],["20241206","1.520","1.539","1.559","1.511","22907229.94","352137","0.00%","0.023","1.52%"],["20241129","1.537","1.516","1.538","1.505","19246901.75","293179","0.00%","-0.014","-0.92%"],["20241122","1.515","1.530","1.563","1.513","28580017.02","439783","0.00%","-0.004","-0.26%"],["20241115","1.569","1.534","1.575","1.530","38831166.00","601681","0.00%","-0.035","-2.23%"],["20241108","1.525","1.569","1.606","1.506","53659980.06","835250","0.00%","0.049","3.22%"],["20241101","1.542","1.520","1.584","1.495","56541755.17","874508","0.00%","-0.002","-0.13%"],["20241025","1.580","1.522","1.580","1.521","47645673.49","739346","0.00%","-0.049","-3.12%"],["20241018","1.560","1.571","1.611","1.546","72832581.65","1149135","0.00%","0.025","1.62%"],["20241011","1.424","1.546","1.580","1.423","87795819.79","1338907","0.00%","0.092","6.33%"],["20240930","1.414","1.454","1.505","1.414","21614322.77","316767","0.00%","-0.025","-1.69%"],["20240927","1.575","1.479","1.577","1.468","59487336.01","912241","0.00%","-0.079","-5.07%"],["20240920","1.541","1.558","1.582","1.526","25773976.17","400072","0.00%","0.005","0.32%"],["20240913","1.436","1.553","1.562","1.428","54188225.01","810269","0.00%","0.095","6.52%"],["20240906","1.564","1.458","1.589","1.437","65347850.50","978706","0.00%","-0.088","-5.69%"],["20240830","1.582","1.546","1.593","1.510","34998215.73","542144","0.00%","-0.035","-2.21%"],["20240823","1.594","1.581","1.607","1.556","45940888.66","728955","0.00%","-0.021","-1.31%"],["20240816","1.424","1.602","1.608","1.418","60529632.68","917853","0.00%","0.188","13.30%"],["20240809","1.396","1.414","1.446","1.333","72972887.61","1015840","0.00%","-0.067","-4.52%"],["20240802","1.537","1.481","1.597","1.475","52988488.50","813873","0.00%","-0.019","-1.27%"],["20240726","1.580","1.500","1.610","1.438","52749533.07","799893","0.00%","-0.117","-7.24%"],["20240719","1.726","1.617","1.736","1.586","34517538.88","575351","0.00%","-0.059","-3.52%"],["20240712","1.661","1.676","1.769","1.659","42043031.49","719896","0.00%","0.017","1.02%"],["20240705","1.698","1.659","1.729","1.631","43522717.12","732875","0.00%","-0.052","-3.04%"],["20240628","1.667","1.711","1.733","1.619","50361713.03","846254","0.00%","0.027","1.60%"],["20240621","1.674","1.684","1.773","1.661","65216888.92","1113291","0.00%","0.027","1.63%"],["20240614","1.548","1.657","1.680","1.539","37469569.38","609118","0.00%","0.109","7.04%"],["20240607","1.472","1.548","1.554","1.456","25334671.93","382272","0.00%","0.100","6.91%"],["20240531","1.451","1.448","1.488","1.418","28198315.67","411710","0.00%","0.038","2.70%"],["20240524","1.402","1.410","1.487","1.402","38171322.94","552949","0.00%","0.004","0.28%"],["20240517","1.320","1.406","1.409","1.318","31042635.55","423369","0.00%","0.082","6.19%"],["20240510","1.321","1.324","1.338","1.310","15340115.05","202826","0.00%","0.007","0.53%"],["20240430","1.335","1.317","1.336","1.305","7731491.00","102146","0.00%","0.011","0.84%"],["20240426","1.235","1.306","1.316","1.224","31253539.51","398482","0.00%","0.038","3.00%"],["20240419","1.359","1.268","1.380","1.258","32564872.79","425811","0.00%","-0.119","-8.58%"],["20240412","1.355","1.387","1.390","1.317","22186886.38","299194","0.00%","0.030","2.21%"],["20240403","1.385","1.357","1.398","1.346","10988807.56","151425","0.00%","-0.016","-1.17%"],["20240329","1.348","1.373","1.404","1.348","23823282.69","329708","0.00%","0.027","2.01%"],["20240322","1.410","1.346","1.444","1.342","35711402.81","498677","0.00%","-0.073","-5.14%"],["20240315","1.368","1.419","1.495","1.362","49546110.87","705176","0.00%","-0.012","-0.84%"],["20240308","1.418","1.431","1.446","1.328","62762177.39","876528","0.00%","0.060","4.38%"],["20240301","1.312","1.371","1.371","1.301","37154141.41","493963","0.00%","0.046","3.47%"],["20240223","1.236","1.325","1.329","1.230","39369754.67","498557","0.00%","0.066","5.24%"],["20240208","1.208","1.259","1.262","1.205","28051686.62","344730","0.00%","0.069","5.80%"],["20240202","1.162","1.190","1.208","1.155","21917997.33","259256","0.00%","0.020","1.71%"],["20240126","1.183","1.170","1.214","1.165","38541760.46","454658","0.00%","0.024","2.09%"],["20240119","1.103","1.146","1.148","1.097","22418764.06","250807","0.00%","0.045","4.09%"],["20240112","1.044","1.101","1.105","1.038","7419038.24","80457","0.00%","0.062","5.97%"],["20240105","1.077","1.039","1.080","1.036","4043012.90","42698","0.00%","-0.043","-3.97%"],["20231229","1.081","1.082","1.094","1.077","5602213.16","60813","0.00%","0.005","0.46%"],["20231222","1.063","1.077","1.085","1.063","5857270.71","62952","0.00%","0.019","1.80%"],["20231215","1.032","1.058","1.082","1.030","6266159.48","66255","0.00%","0.033","3.22%"],["20231208","1.018","1.025","1.025","0.999","3398840.72","34401","0.00%","0.003","0.29%"],["20231201","1.027","1.022","1.033","1.018","2071045.17","21242","0.00%","-0.013","-1.26%"],["20231124","1.039","1.035","1.050","1.024","3783835.14","39261","0.00%","-0.006","-0.58%"],["20231117","1.003","1.041","1.046","1.000","2941102.80","30116","0.00%","0.063","6.44%"],["20231110","0.954","0.978","0.987","0.954","2348794.13","22781","0.00%","0.037","3.93%"],["20231103","0.912","0.941","0.947","0.909","3660340.82","33980","0.00%","0.029","3.18%"],["20231027","0.939","0.912","0.959","0.905","2700169.92","24904","0.00%","-0.038","-4.00%"],["20231020","0.973","0.950","0.985","0.942","1244775.85","11998","0.00%","-0.038","-3.85%"],["20231013","0.956","0.988","0.995","0.953","1404035.95","13649","0.00%","0.054","5.78%"],["20230928","0.939","0.934","0.941","0.922","914221.81","8537","0.00%","-0.007","-0.74%"],["20230922","0.973","0.941","0.977","0.931","1518991.45","14503","0.00%","-0.055","-5.52%"],["20230915","0.995","0.996","1.000","0.983","1849049.38","18336","0.00%","-0.004","-0.40%"],["20230908","0.996","1.000","1.008","0.984","1598719.00","15970","0.00%","0.004","0.40%"],["20230901","0.960","0.996","1.001","0.959","2547401.57","25045","0.00%","0.036","3.75%"],["20230825","0.947","0.960","1.004","0.947","2915007.58","28458","0.00%","0.014","1.48%"],["20230818","0.947","0.946","0.980","0.942","1775591.78","17054","0.00%","-0.015","-1.56%"],["20230811","0.981","0.961","0.990","0.957","2306438.12","22415","0.00%","-0.020","-2.04%"]],"dataDiv":[["20250430","1.392","1.393","1.408","1.388","15118364.35","211440","0.00%","-0.001","-0.07%"],["20250425","1.320","1.394","1.400","1.307","30698407.00","416106","0.00%","0.068","5.13%"],["20250418","1.384","1.326","1.399","1.321","32071756.00","435055","0.00%","-0.034","-2.50%"],["20250411","1.230","1.360","1.375","1.201","44190042.87","573620","0.00%","-0.007","-0.51%"],["20250403","1.372","1.367","1.417","1.350","32476838.70","448263","0.00%","-0.048","-3.39%"],["20250328","1.448","1.415","1.496","1.411","35369529.09","514839","0.00%","-0.012","-0.84%"],["20250321","1.412","1.427","1.443","1.392","35472290.02","502952","0.00%","0.028","2.00%"],["20250314","1.443","1.399","1.454","1.343","62238473.04","860688","0.00%","-0.050","-3.45%"],["20250307","1.496","1.449","1.505","1.437","36383310.79","531935","0.00%","-0.027","-1.83%"],["20250228","1.560","1.476","1.569","1.465","30768458.07","469882","0.00%","-0.117","-7.34%"],["20250221","1.606","1.593","1.645","1.589","26901096.53","434833","0.00%","-0.012","-0.75%"],["20250214","1.583","1.605","1.610","1.575","14411170.90","229665","0.00%","0.009","0.56%"],["20250207","1.596","1.596","1.609","1.589","10549374.23","168609","0.00%","-0.009","-0.56%"],["20250127","1.610","1.605","1.617","1.600","4777138.40","76664","0.00%","-0.033","-2.01%"],["20250124","1.636","1.638","1.655","1.630","18003568.76","295529","0.00%","0.014","0.86%"],["20250117","1.603","1.624","1.639","1.580","23833387.65","383205","0.00%","-0.002","-0.12%"],["20250110","1.646","1.626","1.704","1.624","33220027.47","549819","0.00%","0.005","0.31%"],["20250103","1.615","1.621","1.632","1.600","21512490.20","348139","0.00%","-0.017","-1.04%"],["20241227","1.605","1.638","1.666","1.604","36222906.62","594466","0.00%","0.061","3.87%"],["20241220","1.581","1.577","1.663","1.572","48931264.66","793679","0.00%","-0.001","-0.06%"],["20241213","1.547","1.578","1.582","1.518","24754360.17","384943","0.00%","0.039","2.53%"],["20241206","1.520","1.539","1.559","1.511","22907229.94","352137","0.00%","0.023","1.52%"],["20241129","1.537","1.516","1.538","1.505","19246901.75","293179","0.00%","-0.014","-0.92%"],["20241122","1.515","1.530","1.563","1.513","28580017.02","439783","0.00%","-0.004","-0.26%"],["20241115","1.569","1.534","1.575","1.530","38831166.00","601681","0.00%","-0.035","-2.23%"],["20241108","1.525","1.569","1.606","1.506","53659980.06","835250","0.00%","0.049","3.22%"],["20241101","1.542","1.520","1.584","1.495","56541755.17","874508","0.00%","-0.002","-0.13%"],["20241025","1.580","1.522","1.580","1.521","47645673.49","739346","0.00%","-0.049","-3.12%"],["20241018","1.560","1.571","1.611","1.546","72832581.65","1149135","0.00%","0.025","1.62%"],["20241011","1.424","1.546","1.580","1.423","87795819.79","1338907","0.00%","0.092","6.33%"],["20240930","1.414","1.454","1.505","1.414","21614322.77","316767","0.00%","-0.025","-1.69%"],["20240927","1.575","1.479","1.577","1.468","59487336.01","912241","0.00%","-0.079","-5.07%"],["20240920","1.541","1.558","1.582","1.526","25773976.17","400072","0.00%","0.005","0.32%"],["20240913","1.436","1.553","1.562","1.428","54188225.01","810269","0.00%","0.095","6.52%"],["20240906","1.564","1.458","1.589","1.437","65347850.50","978706","0.00%","-0.088","-5.69%"],["20240830","1.582","1.546","1.593","1.510","34998215.73","542144","0.00%","-0.035","-2.21%"],["20240823","1.594","1.581","1.607","1.556","45940888.66","728955","0.00%","-0.021","-1.31%"],["20240816","1.424","1.602","1.608","1.418","60529632.68","917853","0.00%","0.188","13.30%"],["20240809","1.396","1.414","1.446","1.333","72972887.61","1015840","0.00%","-0.067","-4.52%"],["20240802","1.537","1.481","1.597","1.475","52988488.50","813873","0.00%","-0.019","-1.27%"],["20240726","1.580","1.500","1.610","1.438","52749533.07","799893","0.00%","-0.117","-7.24%"],["20240719","1.726","1.617","1.736","1.586","34517538.88","575351","0.00%","-0.059","-3.52%"],["20240712","1.661","1.676","1.769","1.659","42043031.49","719896","0.00%","0.017","1.02%"],["20240705","1.698","1.659","1.729","1.631","43522717.12","732875","0.00%","-0.052","-3.04%"],["20240628","1.667","1.711","1.733","1.619","50361713.03","846254","0.00%","0.027","1.60%"],["20240621","1.674","1.684","1.773","1.661","65216888.92","1113291","0.00%","0.027","1.63%"],["20240614","1.548","1.657","1.680","1.539","37469569.38","609118","0.00%","0.109","7.04%"],["20240607","1.472","1.548","1.554","1.456","25334671.93","382272","0.00%","0.100","6.91%"],["20240531","1.451","1.448","1.488","1.418","28198315.67","411710","0.00%","0.038","2.70%"],["20240524","1.402","1.410","1.487","1.402","38171322.94","552949","0.00%","0.004","0.28%"],["20240517","1.320","1.406","1.409","1.318","31042635.55","423369","0.00%","0.082","6.19%"],["20240510","1.321","1.324","1.338","1.310","15340115.05","202826","0.00%","0.007","0.53%"],["20240430","1.335","1.317","1.336","1.305","7731491.00","102146","0.00%","0.011","0.84%"],["20240426","1.235","1.306","1.316","1.224","31253539.51","398482","0.00%","0.038","3.00%"],["20240419","1.359","1.268","1.380","1.258","32564872.79","425811","0.00%","-0.119","-8.58%"],["20240412","1.355","1.387","1.390","1.317","22186886.38","299194","0.00%","0.030","2.21%"],["20240403","1.385","1.357","1.398","1.346","10988807.56","151425","0.00%","-0.016","-1.17%"],["20240329","1.348","1.373","1.404","1.348","23823282.69","329708","0.00%","0.027","2.01%"],["20240322","1.410","1.346","1.444","1.342","35711402.81","498677","0.00%","-0.073","-5.14%"],["20240315","1.368","1.419","1.495","1.362","49546110.87","705176","0.00%","-0.012","-0.84%"],["20240308","1.418","1.431","1.446","1.328","62762177.39","876528","0.00%","0.060","4.38%"],["20240301","1.312","1.371","1.371","1.301","37154141.41","493963","0.00%","0.046","3.47%"],["20240223","1.236","1.325","1.329","1.230","39369754.67","498557","0.00%","0.066","5.24%"],["20240208","1.208","1.259","1.262","1.205","28051686.62","344730","0.00%","0.069","5.80%"],["20240202","1.162","1.190","1.208","1.155","21917997.33","259256","0.00%","0.020","1.71%"],["20240126","1.183","1.170","1.214","1.165","38541760.46","454658","0.00%","0.024","2.09%"],["20240119","1.103","1.146","1.148","1.097","22418764.06","250807","0.00%","0.045","4.09%"],["20240112","1.044","1.101","1.105","1.038","7419038.24","80457","0.00%","0.062","5.97%"],["20240105","1.077","1.039","1.080","1.036","4043012.90","42698","0.00%","-0.043","-3.97%"],["20231229","1.081","1.082","1.094","1.077","5602213.16","60813","0.00%","0.005","0.46%"],["20231222","1.063","1.077","1.085","1.063","5857270.71","62952","0.00%","0.019","1.80%"],["20231215","1.032","1.058","1.082","1.030","6266159.48","66255","0.00%","0.033","3.22%"],["20231208","1.018","1.025","1.025","0.999","3398840.72","34401","0.00%","0.003","0.29%"],["20231201","1.027","1.022","1.033","1.018","2071045.17","21242","0.00%","-0.013","-1.26%"],["20231124","1.039","1.035","1.050","1.024","3783835.14","39261","0.00%","-0.006","-0.58%"],["20231117","1.003","1.041","1.046","1.000","2941102.80","30116","0.00%","0.063","6.44%"],["20231110","0.954","0.978","0.987","0.954","2348794.13","22781","0.00%","0.037","3.93%"],["20231103","0.912","0.941","0.947","0.909","3660340.82","33980","0.00%","0.029","3.18%"],["20231027","0.939","0.912","0.959","0.905","2700169.92","24904","0.00%","-0.038","-4.00%"],["20231020","0.973","0.950","0.985","0.942","1244775.85","11998","0.00%","-0.038","-3.85%"],["20231013","0.956","0.988","0.995","0.953","1404035.95","13649","0.00%","0.054","5.78%"],["20230928","0.939","0.934","0.941","0.922","914221.81","8537","0.00%","-0.007","-0.74%"],["20230922","0.973","0.941","0.977","0.931","1518991.45","14503","0.00%","-0.055","-5.52%"],["20230915","0.995","0.996","1.000","0.983","1849049.38","18336","0.00%","-0.004","-0.40%"],["20230908","0.996","1.000","1.008","0.984","1598719.00","15970","0.00%","0.004","0.40%"],["20230901","0.960","0.996","1.001","0.959","2547401.57","25045","0.00%","0.036","3.75%"],["20230825","0.947","0.960","1.004","0.947","2915007.58","28458","0.00%","0.014","1.48%"],["20230818","0.947","0.946","0.980","0.942","1775591.78","17054","0.00%","-0.015","-1.56%"],["20230811","0.981","0.961","0.990","0.957","2306438.12","22415","0.00%","-0.020","-2.04%"]]}
        if (cycleType.equals(KLINE_TYPE_SOHU_MKLINE_WEEK) || cycleType.equals(KLINE_TYPE_SOHU_MKLINE_DAY) || cycleType.equals(KLINE_TYPE_SOHU_MKLINE_MONTH)) {
            JSONObject klineRsObj = JSON.parseObject(rs);
            if (klineRsObj == null) {
                return null;
            }
            klines = JSON.parseArray(klineRsObj.getString("dataBasic"));
        } else {
            klines = JSON.parseArray(rs);
        }

        if (klines == null) {
            return null;
        }
        List<Kline> klineRs = new ArrayList<>();
        for (Object klineObj : klines) {
            if (limit-- <= 0) {
//                System.out.println("限定个数已完成：" + limit);
                break;
            }
            Kline kline = new Kline();
            JSONArray klineString = (JSONArray) klineObj;
            String ktime = klineString.getString(0);
//            if (ktime.contains("-")) {
//                ktime = ktime.replace("-", "");
//            }
            kline.setKtime(ktime);
            //["2025-04-23","1.320","1.371","0.045","3.39%","1.307","1.374","16229213","216742.266","25.83%"]
            //["20250430","1.392","1.393","1.408","1.388","15118364.35","211440","0.00%","-0.001","-0.07%"]
            //  日期，开盘，收盘,最高，最低，涨跌额，涨跌幅，成交量，成交额，振幅
            //['2504251345','1.396','1.395','1.396','1.395','89565','1250','0.00%','-0.07%','-0.001']
            kline.setOpenAmt(new BigDecimal(klineString.getString(1)));
            BigDecimal closeAmt = new BigDecimal(klineString.getString(2));
            kline.setCloseAmt(closeAmt);

            kline.setMinAmt(new BigDecimal(klineString.getString(4)));
            kline.setMaxAmt(new BigDecimal(klineString.getString(3)));
            if (cycleType.equals(KLINE_TYPE_SOHU_MKLINE_WEEK) || cycleType.equals(KLINE_TYPE_SOHU_MKLINE_DAY) || cycleType.equals(KLINE_TYPE_SOHU_MKLINE_MONTH)) {
                kline.setZhangDieE(new BigDecimal(klineString.getString(8)));
                String zhangDieFu = klineString.getString(9);
                if (zhangDieFu.contains("%")) {
                    zhangDieFu = zhangDieFu.replace("%", "");
                    kline.setZhangDieFu(new BigDecimal(zhangDieFu));
                }
            } else {
                kline.setZhangDieE(new BigDecimal(klineString.getString(9)));
                String zhangDieFu = klineString.getString(8);
                if (zhangDieFu.contains("%")) {
                    zhangDieFu = zhangDieFu.replace("%", "");
                    kline.setZhangDieFu(new BigDecimal(zhangDieFu));
                }
            }
            kline.setCjl(new BigDecimal(klineString.getString(5)));
            kline.setCje(new BigDecimal(klineString.getString(6)));
            kline.setZqdm(zqdm);
            klineRs.add(kline);
        }
        return klineRs;
    }

    /**
     * http查询k线(历史查询)，不含今日数据
     * https://hq.stock.sohu.com/mkline/cn/050/cn_510050-11_2.html?_=1745468377604
     * https://q.stock.sohu.com/hisHq?code=cn_159915&start=20240301&end=20250424&stat=1&order=D&period=w&callback=historySearchHandler&rt=jsonp
     *
     * @param zqdm
     * @param cycleType
     * @param start
     * @param end
     * @return
     */
    public static String httpKlineRsStrHis(String zqdm, String cycleType, String start, String end) {
        boolean isShowLog = false;//是否显示日志
        long curTime = System.currentTimeMillis();
        //https://hq.stock.sohu.com/mkline/cn/050/cn_510050-11_2.html?_=1745468377604
        //https://q.stock.sohu.com/hisHq?code=cn_159915&start=20240301&end=20250424&stat=1&order=D&period=w&callback=historySearchHandler&rt=jsonp
        //https://q.stock.sohu.com/hisHq?code=cn_159509&start=20250114&end=20250424&stat=1&order=D&period=w&callback=historySearchHandler&rt=jsonp
        StringBuffer url = new StringBuffer();
        url.append("https://q.stock.sohu.com/hisHq");//前缀
        StringBuffer urlParam = new StringBuffer();
        urlParam.append("code=cn_" + zqdm);//证券代码
        urlParam.append("&start=" + start);
        urlParam.append("&end=" + end);
        urlParam.append("&stat=0");//是否统计
        urlParam.append("&order=D");
        urlParam.append("&period=" + cycleType);
        urlParam.append("&callback=historySearchHandler");
        urlParam.append("&rt=jsonp");


        if (isShowLog) {
//            System.out.println("请求url:" + url.toString());
//            System.out.println("请求url:" + url + "?" + urlParam.toString());
        }
        String rs = "";
        try {
            rs = HttpUtil.sendGet(url.toString(), urlParam.toString(), "");
        } catch (Exception e) {
            System.out.println("/** http重试 **/" + e);
            rs = HttpUtil.sendGet(url.toString(), urlParam.toString(), "");
        }
        /**
         * 如果返回异常，n次重试
         */
        for (int i = 0; i < 3; i++) {
            if (StringUtils.isBlank(rs)) {
                rs = HttpUtil.sendGet(url.toString(), urlParam.toString(), "");
            } else {
                break;
            }
        }

        //过滤返回字符串
        if (rs.startsWith("historySearchHandler([{")) {
//            rs = rs.substring(rs.indexOf("quote_w_dividend({"));
            rs = rs.replace("historySearchHandler([{", "{");
        }
        if (rs.endsWith("}])")) {
            rs = rs.replace("}])", "}");
        }
        if (isShowLog) {
            System.out.println("rs:" + rs);
        }
        return rs;
    }

    /**
     * http查询k线
     * https://hq.stock.sohu.com/mkline/cn/050/cn_510050-11_2.html?_=174631518752
     * https://hq.stock.sohu.com/mkline/cn/331/cn_159331-11_2.html?_=174631518752
     * https://hq.stock.sohu.com/mkline/cn/050/cn_510050-10_2.html?_=174631518756
     * https://hq.stock.sohu.com/mkline/cn/509/cn_159509/11_2.html?_=1746316319289
     *
     * @param zqdm
     * @param cycleType
     * @param start
     * @param end
     * @return
     */
    public static String httpKlineRsStrMkline(String zqdm, String cycleType, String start, String end) {
        boolean isShowLog = false;//是否显示日志
        long curTime = System.currentTimeMillis();
        //https://hq.stock.sohu.com/mkline/cn/050/cn_510050-11_1.html?_=1745468377604
        //https://hq.stock.sohu.com/cn/509/cn_159509-9_5m.html?openinwebview_finance=false&_=1746318422466
        StringBuffer url = new StringBuffer();
        if (cycleType.equals(KLINE_TYPE_SOHU_MKLINE_WEEK) || cycleType.equals(KLINE_TYPE_SOHU_MKLINE_DAY) || cycleType.equals(KLINE_TYPE_SOHU_MKLINE_MONTH)) {
            url.append("https://hq.stock.sohu.com/mkline/");//前缀
        } else {
            url.append("https://hq.stock.sohu.com/");//前缀
        }
        url.append("cn/" + zqdm.substring(3) + "/");
        url.append("cn_" + zqdm + "-");
        url.append(cycleType);//周期
//        url.append(cycleType + "_2");//周期
        url.append(".html");//周期
        StringBuffer urlParam = new StringBuffer();
        urlParam.append("_=" + curTime);

        if (isShowLog) {
//            System.out.println("请求url:" + url.toString());
            System.out.println("请求url:" + url + "?" + urlParam.toString());
        }
        String rs = "";
        try {
            rs = HttpUtil.sendGet(url.toString(), urlParam.toString(), "");
        } catch (Exception e) {
            System.out.println("/** http重试 **/" + e);
            rs = HttpUtil.sendGet(url.toString(), urlParam.toString(), "");
        }
        /**
         * 如果返回异常，n次重试
         */
        for (int i = 0; i < 3; i++) {
            if (StringUtils.isBlank(rs)) {
                rs = HttpUtil.sendGet(url.toString(), urlParam.toString(), "");
            } else {
                break;
            }
        }

        //过滤返回字符串
        List<String> startListMwd = Arrays.asList("quote_m_dividend", "quote_w_dividend", "quote_d_dividend", "kline_5m");
        for (String startStr : startListMwd) {
            if (rs.startsWith(startStr + "({")) {
                rs = rs.replace(startStr + "({", "{");
            }
        }
        List<String> startListMinite = Arrays.asList("kline_5m","kline_15m","kline_30m","kline_60m");
        for (String startStr : startListMinite) {
            if (rs.startsWith(startStr + "([")) {
                rs = rs.replace(startStr + "([", "[");
            }
        }
        if (rs.endsWith("])")) {
            rs = rs.replace("])", "]");
        }
        if (isShowLog) {
            System.out.println("rs:" + rs);
        }
        return rs;
    }

}
